---
import Layout from "../../../layouts/Layout.astro";
---

<Layout title="Advanced Usage - Preact">
  <div class="mb-4 text-sm font-mono text-neutral-500 uppercase tracking-widest">
    @elekcsv/preact
  </div>

  <h1 class="mb-8 border-b-2 border-black pb-4">5.3 Advanced Usage</h1>

  <p class="text-xl text-neutral-600 leading-relaxed mb-10">
    The Preact importer runs as a step-based state machine. You can drive a full
    multi-step import experience (parse, map, review, complete) from one hook.
  </p>

  <h2>Working with Steps</h2>
  <p>
    Use <code>step</code> and helper flags to branch your UI, or subscribe to
    <code>onStepChange</code> for analytics and workflow side effects.
  </p>

  <pre><code>import &#123; useCSVImporter &#125; from '@elekcsv/preact'

const &#123;
  step,
  state,
  isLoading,
  hasErrors,
  loadFile,
  confirmMapping,
  accept,
  reset,
&#125; = useCSVImporter(&#123;
  schema,
  onStepChange: (nextStep) =&gt; &#123;
    console.log('Importer step changed:', nextStep)
  &#125;,
&#125;)

if (isLoading) return &lt;Spinner /&gt;
if (step === 'mapping') return &lt;MappingEditor state=&#123;state&#125; onConfirm=&#123;confirmMapping&#125; /&gt;
if (step === 'review' && hasErrors) return &lt;ErrorReview state=&#123;state&#125; onAccept=&#123;accept&#125; /&gt;
if (step === 'complete') return &lt;SuccessScreen onReset=&#123;reset&#125; /&gt;</code></pre>

  <h2>Callbacks for Completion and Failure</h2>
  <p>
    Keep your component lean by using hook callbacks instead of scattered
    <code>useEffect</code> logic.
  </p>

  <pre><code>const importer = useCSVImporter(&#123;
  schema,
  autoMap: true,
  autoMapThreshold: 0.85,
  maxPreviewRows: 20,

  onComplete: (result) =&gt; &#123;
    console.log(`Imported $&#123;result.stats.totalRows&#125; rows`)
    console.log(`Errors: $&#123;result.stats.errorCount&#125;`)
  &#125;,

  onError: (message) =&gt; &#123;
    console.error('Import failed:', message)
  &#125;,
&#125;)</code></pre>

  <div class="mt-16 flex justify-between">
    <a
      href="/docs/preact/basic"
      class="inline-flex items-center gap-2 px-6 py-3 border border-neutral-300 text-black hover:border-black rounded-md text-sm font-medium no-underline! transition-colors"
      style="text-decoration:none;"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
        ><path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Previous
    </a>
    <a
      href="/docs/preact/full"
      class="inline-flex items-center gap-2 px-6 py-3 bg-black text-white hover:bg-neutral-800 rounded-md text-sm font-medium no-underline! transition-colors"
      style="text-decoration:none;"
    >
      Next: Full API
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
        ><path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
      </svg>
    </a>
  </div>
</Layout>
